# PR Service (Go + PostgreSQL)

### –ê–≤—Ç–æ—Ä: –ú–∏–Ω—å–∫–æ –°–µ—Ä–≥–µ–π
### –Ø–∑—ã–∫: `Golang`
### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: `PostgreSQL`
### –¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è —Å—Ç–∞–∂—ë—Ä–∞ (–æ—Å–µ–Ω–Ω—è—è –≤–æ–ª–Ω–∞ 2025)

---

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–∞–º–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è–º–∏ —Ä–µ–≤—å—é–µ—Ä–æ–≤ –Ω–∞ pull request'—ã.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

- –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å UUID –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö.
- CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ–º–∞–Ω–¥ –∏ PR.
- –ú–∞—Å—Å–æ–≤–∞—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ–º–∞–Ω–¥—ã.
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π —Ä–µ–≤—å—é–µ—Ä–æ–≤.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É.
- –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker –∏ `docker-compose` —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏ `app` –∏ `test`.

---

# –ó–∞–ø—É—Å–∫

## –°–æ–±—Ä–∞–Ω–∏–µ –¥–æ–∫–µ—Ä–∞
–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
```bash
  docker-compose up --build
```
## –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

### –ù–∏–∂–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª—å, —Å–æ–≤–µ—Ç—É—é –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
curl -X POST http://localhost:8080/team/add \
  -H "Content-Type: application/json" \
  -d '{
    "team_name": "payments",
    "members": [
      { "user_id": "u1", "username": "Alice", "is_active": true },
      { "user_id": "u2", "username": "Bob", "is_active": true },
      { "user_id": "u3", "username": "Charlie", "is_active": true },
      { "user_id": "u4", "username": "Kim", "is_active": true }
    ]
  }'
```
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:
```bash
curl -X GET http://localhost:8080/team/get?team_name=payments
```
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —é–∑–µ—Ä–∞:
```bash
curl -X POST http://localhost:8080/users/setIsActive \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "u3",
    "is_active": false
  }'
```
- –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —é–∑–µ—Ä–∞:
```bash
curl -X POST http://localhost:8080/users/setIsActive \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "u3",
    "is_active": true
  }'
```
- –°–æ–∑–¥–∞–Ω–∏–µ pull request`–∞:
```bash
curl -X POST http://localhost:8080/pullRequest/create \
  -H "Content-Type: application/json" \
  -d '{
    "pull_request_id": "pr-1",
    "pull_request_name": "Add payments module",
    "author_id": "u1"
  }'
```
- –ü—Ä–æ—Å–º–æ—Ç—Ä pull request`–æ–≤, –≥–¥–µ –Ω–∞–∑–Ω–∞—á–µ–Ω —é–∑–µ—Ä —Ä–µ–≤—å—é–µ—Ä–æ–º:
```bash
curl "http://localhost:8080/users/getReview?user_id=u2"
```
- –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–≤—å—é–µ—Ä–∞:
```bash
curl -X POST http://localhost:8080/pullRequest/reassign \
  -H "Content-Type: application/json" \
  -d '{
    "pull_request_id": "pr-1",
    "old_user_id": "u4"
  }'
```

- –ü–æ–º–µ—Ç–∫–∞ PR –∫–∞–∫ MERGED:
```bash
curl -X POST http://localhost:8080/pullRequest/merge \
  -H "Content-Type: application/json" \
  -d '{"pull_request_id": "pr-1"}'
```
- –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å —Ä–µ–≤—å—é–≤–µ—Ä–∞ –ø–æ—Å–ª–µ MERGE:
```bash
curl -X POST http://localhost:8080/pullRequest/reassign \
  -H "Content-Type: application/json" \
  -d '{
    "pull_request_id": "pr-1",
    "old_user_id": "u4"
  }'
```
- –°–æ–∑–¥–∞–µ–º –≤—Ç–æ—Ä–æ–π PR –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª—è —Ä–µ–≤—å—é:
```bash
curl -X POST http://localhost:8080/pullRequest/create \
  -H "Content-Type: application/json" \
  -d '{
    "pull_request_id": "pr-1",
    "pull_request_name": "pr-name-1",
    "author_id": "u1"
  }'
```
```bash
curl -X GET http://localhost:8080/users/getReview?user_id=u2
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏—Ç—ã:
- –ú–∞—Å—Å–æ–≤–∞—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è:
```bash
curl -X POST http://localhost:8080/users/massDeactivate \
  -H "Content-Type: application/json" \
  -d '{
    "team_name": "frontend",
}'
```
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π:
```bash
curl -X GET http://localhost:8080/stats/reviewers
```

## –î–æ–ø—É—â–µ–Ω–∏—è

### üîπ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `id` –≤ —Ñ–æ—Ä–º–∞—Ç–µ UUID –≤ —Ç–∞–±–ª–∏—Ü–µ `teams`
–í —Ç–∞–±–ª–∏—Ü–µ `teams` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–µ `id` —Ç–∏–ø–∞ **UUID**, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ —á—Ç–æ –ø–æ –∑–∞–¥–∞–Ω–∏—é –º–æ–∂–Ω–æ –±—ã–ª–æ –æ–±–æ–π—Ç–∏—Å—å –∏–º–µ–Ω–µ–º –∫–æ–º–∞–Ω–¥—ã.  
–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ:

- –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∏–º—è –∫–æ–º–∞–Ω–¥—ã –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –±—ã—Ç—å –Ω–∞–¥—ë–∂–Ω—ã–º –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–º –∫–ª—é—á–æ–º (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã);
- UUID –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ë–î;
- —É–ø—Ä–æ—â–∞–µ—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –±–µ–∑ —Ä–∏—Å–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π.

–í –∫—Ä—É–ø–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –Ω–∞–ª–∏—á–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–æ–¥—Ö–æ–¥.

---

### üîπ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ORM (GORM)
ORM —á–∞—Å—Ç–æ —Å—á–∏—Ç–∞—é—Ç **–∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–º** –∏–∑-–∑–∞:

- —Å–∫—Ä—ã—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π,
- –Ω–µ—è–≤–Ω—ã—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤,
- –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö –≤—ã–±–æ—Ä–∫–∞—Ö.

–û–¥–Ω–∞–∫–æ –≤ —Ç–µ–∫—É—â–µ–º –ø—Ä–æ–µ–∫—Ç–µ:

- –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Å—Ç—ã–µ –∏ –Ω–µ–±–æ–ª—å—à–∏–µ,
- –Ω–µ—Ç —Ç—è–∂—ë–ª—ã—Ö –∞–≥—Ä–µ–≥–∞—Ü–∏–π,
- —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–±–∏–ª—å–Ω–∞.

–ü–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GORM **–≤–∞–ª–∏–¥–Ω–æ –∏ —É–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É**, –Ω–µ —Å–æ–∑–¥–∞–≤–∞—è –ª–∏—à–Ω–∏—Ö –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤.

---

### üîπ –ö–∞—Å–∫–∞–¥–Ω–∞—è –º–æ–¥–µ–ª—å —Å–≤—è–∑–µ–π –≤ –ë–î
–í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ (`ON DELETE CASCADE`, `ON UPDATE CASCADE`).

–ü–ª—é—Å—ã —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö;
- —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–µ –æ—Å—Ç–∞–≤–ª—è–µ—Ç ¬´–º—É—Å–æ—Ä–Ω—ã–µ¬ª –∑–∞–≤–∏—Å–∏–º—ã–µ –∑–∞–ø–∏—Å–∏;
- —É–ø—Ä–æ—â–∞–µ—Ç—Å—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî –ë–î —Å–∞–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å.

–ö–∞—Å–∫–∞–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –≤ —Å–∏—Å—Ç–µ–º–∞—Ö, –≥–¥–µ –æ–±—ä–µ–∫—Ç—ã –∂—ë—Å—Ç–∫–æ —Å–≤—è–∑–∞–Ω—ã –∏ –¥–æ–ª–∂–Ω—ã –≤–µ—Å—Ç–∏ —Å–µ–±—è –∫–∞–∫ –µ–¥–∏–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å.
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

–°—Ü–µ–Ω–∞—Ä–∏–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (`prreviewer_test`), –µ—Å–ª–∏ –æ–Ω–∞ –µ—â—ë –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker Compose –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Ä—Ç 5433):

```bash
docker-compose -f docker-compose.test.yaml up -d
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã (—Å—Ü–µ–Ω–∞—Ä–∏–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 5433):

```bash
go test ./test/integration/...
go test ./test/e2e/...
```

3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```bash
docker-compose -f docker-compose.test.yaml down
```




## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

* `test/integration/` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤

    * `common.go` - –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)
    * `team_handler_test.go` - –¢–µ—Å—Ç—ã –¥–ª—è —Ö—ç–Ω–¥–ª–µ—Ä–∞ –∫–æ–º–∞–Ω–¥
    * `user_handler_test.go` - –¢–µ—Å—Ç—ã –¥–ª—è —Ö—ç–Ω–¥–ª–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    * `pr_handler_test.go` - –¢–µ—Å—Ç—ã –¥–ª—è —Ö—ç–Ω–¥–ª–µ—Ä–∞ Pull Request

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤

![img.png](run_tests_logs.png)


## –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –õ–∏–Ω—Ç–µ—Ä

